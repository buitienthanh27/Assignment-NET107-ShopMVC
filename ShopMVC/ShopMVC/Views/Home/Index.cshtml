@model List<ShopMVC.Models.Product>
@{
    ViewData["Title"] = "Trang chủ";
    Layout = "_Layout";
}

<style>
    :root {
        --tech-primary: #0071e3;
        --tech-primary-2: #2997ff;
        --tech-dark: #0e0e11;
        --tech-dark-2: #1d1d1f;
        --tech-gray: #f5f5f7;
        --tech-dim: #a1a1a6;
    }

    /* ===== HERO ===== */
    .hero-tech {
        position: relative;
        color: #fff;
        padding: 68px 0;
        background: radial-gradient(1200px 600px at 80% 10%, rgba(41,151,255,.25), rgba(0,0,0,0)), linear-gradient(180deg, #0b0b0d 0%, #0f1114 100%);
    }

    .hero-tech__eyebrow {
        color: var(--tech-primary-2);
        font-weight: 700;
        margin-bottom: .5rem
    }

    .hero-tech__title {
        font-family: 'Times New Roman';
        color: #fff; /* <-- KHẮC PHỤC MÀU ĐEN */
        text-shadow: 0 2px 12px rgba(0,0,0,.45); /* đọc tốt trên nền tối */
        font-size: clamp(32px,4.2vw,48px);
        font-weight: 800;
        letter-spacing: -.3px;
        line-height: 1.12;
        margin: 0;
    }

    .hero-tech__lead {
        color: #cfd3d8;
        max-width: 640px;
        margin-top: .75rem
    }

    .hero-tech__cta .btn {
        border-radius: 28px;
        padding: .85rem 1.25rem;
        margin-right: .5rem;
        min-height: 44px;
    }

    .btn-primary-tech {
        background: var(--tech-primary);
        border-color: var(--tech-primary);
        color: #fff
    }

    .btn-ghost-tech {
        background: transparent;
        border: 1px solid rgba(255,255,255,.25);
        color: #fff
    }

    .btn-primary-tech:hover {
        filter: brightness(1.06)
    }

    .btn-ghost-tech:hover {
        border-color: #fff
    }

    /* ===== FEATURES ===== */
    .features-tech {
        background: #fff;
        padding: 28px 0
    }

    .feature-tile {
        background: #fff;
        border: 1px solid #eee;
        border-radius: 14px;
        padding: 18px;
        box-shadow: 0 10px 22px rgba(0,0,0,.04);
        height: 100%;
    }

        .feature-tile i {
            font-size: 26px;
            color: var(--tech-primary);
            margin-right: 10px
        }

    /* ===== SECTION HEADING ===== */
    .section-head {
        margin: 18px 0;
    }

    .section-eyebrow {
        color: var(--tech-primary-2);
        font-weight: 700;
        font-size: 1.95rem
    }

    .section-title {
        font-family: 'Times New Roman';
        color: var(--tech-dark-2);
        font-weight: 800;
        font-size: clamp(24px,3.1vw,36px); /* ↓ không vỡ phông */
        letter-spacing: -.2px;
        margin: 4px 0 0;
    }

    /* ===== PRODUCT GRID ===== */
    .section-products {
        background: var(--tech-gray);
        padding: 38px 0
    }

    .product-card {
        display: flex;
        flex-direction: column;
        background: #fff;
        border: 1px solid #ececec;
        border-radius: 16px;
        overflow: hidden;
        height: 100%;
        min-height: 430px; /* cao tối thiểu để cân */
        transition: transform .2s ease, box-shadow .2s ease;
    }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(0,0,0,.06)
        }

    .product-thumb {
        background: #fff;
        height: 230px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
    }

        .product-thumb img {
            max-height: 210px;
            max-width: 90%;
            object-fit: contain
        }

    .badge-tech {
        position: absolute;
        top: 12px;
        left: 12px;
        border-radius: 999px;
        padding: .35rem .7rem;
        font-size: 1.78rem;
        color: #fff
    }

    .badge-new {
        background: var(--tech-primary)
    }

    .badge-low {
        background: #ff9800
    }

    .badge-out {
        background: #999
    }

    .product-body {
        padding: 14px 16px 16px
    }

    .product-meta {
        font-size: 1.85rem;
        color: #888;
        margin-bottom: 4px
    }

    .product-title {
        margin: 0 0 6px
    }

        .product-title a {
            color: var(--tech-dark-2);
            text-decoration: none;
            font-weight: 700;
            font-size: 2.05rem
        }

            .product-title a:hover {
                text-decoration: underline
            }

    .product-price {
        color: #bf081f;
        font-weight: 800;
        font-size: 2.08rem;
        margin-bottom: 10px
    }

    .product-actions {
        font-size: 2rem;
        margin-top: auto;
        display: flex;
        gap: 10px
    }

    .btn-card {
        flex: 1;
        min-height: 44px;
        border-radius: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: .45rem;
    }

    .btn-outline-dark-tech {
        border: 1px solid #222;
        color: #222;
        background: #fff
    }

        .btn-outline-dark-tech:hover {
            background: #222;
            color: #fff
        }

    .btn-primary-tech-2 {
        background: var(--tech-primary);
        border: 1px solid var(--tech-primary);
        color: #fff
    }

        .btn-primary-tech-2:hover {
            filter: brightness(1.07)
        }

    /* ===== CTA STRIP ===== */
    .cta-strip {
        background: #0f1114;
        color: #fff;
        border-radius: 16px;
        padding: 22px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

        .cta-strip p {
            margin: 0;
            color: #cbd0d6
        }

    @@media (max-width: 767.98px) {
        .cta-strip

    {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px
    }

    }</style>

<!-- HERO -->
<section class="hero-tech">
    <div class="container">
        <div class="row align-items-center g-4">
            <div class="col-lg-6">
                <div class="hero-tech__eyebrow">iPhone 15 Series</div>
                <h1 class="hero-tech__title">Titanium. Đẳng cấp mới.</h1>
                <p class="hero-tech__lead">
                    Sức mạnh A17 Pro. Thiết kế titan bền bỉ, nhẹ hơn bao giờ hết. Trải nghiệm hiệu năng đột phá.
                </p>
                <div class="hero-tech__cta mt-3">
                    <a class="btn btn-primary-tech" asp-controller="Product" asp-action="Index">
                        <i class="fa-regular fa-cart-shopping me-1"></i> Mua ngay
                    </a>
                    <a class="btn btn-ghost-tech" asp-controller="Product" asp-action="Index">
                        <i class="fa-regular fa-arrow-right me-1"></i> Xem tất cả
                    </a>
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <img src="~/images/products/iphone15promax.jpg" alt="iPhone 15 Pro Max" style="max-height:480px" />
            </div>
        </div>
    </div>
</section>

<!-- FEATURES -->
<section class="features-tech">
    <div class="container">
        <div class="row g-3">
            <div class="col-6 col-md-3">
                <div class="feature-tile d-flex align-items-start">
                    <i class="fa-light fa-truck-fast"></i>
                    <div><div class="fw-bold">Giao nhanh</div><div class="text-muted small">Trong 2 giờ</div></div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="feature-tile d-flex align-items-start">
                    <i class="fa-light fa-shield-check"></i>
                    <div><div class="fw-bold">Chính hãng</div><div class="text-muted small">Bảo hành đầy đủ</div></div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="feature-tile d-flex align-items-start">
                    <i class="fa-light fa-rotate-left"></i>
                    <div><div class="fw-bold">Đổi trả 30 ngày</div><div class="text-muted small">Lỗi đổi mới</div></div>
                </div>
            </div>
            <div class="col-6 col-md-3">
                <div class="feature-tile d-flex align-items-start">
                    <i class="fa-light fa-credit-card"></i>
                    <div><div class="fw-bold">Trả góp 0%</div><div class="text-muted small">Thủ tục nhanh</div></div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- PRODUCTS -->
<section class="section-products">
    <div class="container">
        <div class="section-head d-flex align-items-end justify-content-between">
            <div>
                <div class="section-eyebrow">SẢN PHẨM MỚI</div>
                <h2 class="section-title">Điện thoại nổi bật</h2>
            </div>
            <a class="btn btn-outline-dark btn-sm" style="min-height:40px; font-size: 2rem; text-align: center;border-radius:12px" asp-controller="Product" asp-action="Index">Xem tất cả</a>
        </div>

        <div class="row g-3">
            @foreach (var p in Model)
            {
                <div class="col-6 col-md-4 col-lg-3">
                    <article class="product-card position-relative">
                        @if (p.Stock == 0)
                        {
                            <span class="badge-tech badge-out">Hết hàng</span>
                        }
                        else if (p.Stock < 10)
                        {

                            <span class="badge-tech badge-low">Sắp hết</span>
                        }
                        else
                        {

                            <span class="badge-tech badge-new">Mới</span>
                        }

                        <div class="product-thumb">
                            <a asp-controller="Product" asp-action="Detail" asp-route-id="@p.ProductId">
                                <img src="~/images/products/@(p.Image ?? "no-image.jpg")" alt="@p.ProductName" />
                            </a>
                        </div>

                        <div class="product-body">
                            <div class="product-meta">@p.Category?.CategoryName</div>
                            <h3 class="product-title">
                                <a asp-controller="Product" asp-action="Detail" asp-route-id="@p.ProductId">@p.ProductName</a>
                            </h3>
                            <div class="product-price">@p.Price.ToString("N0") ₫</div>

                            <div class="product-actions">
                                    <a class="btn btn-outline-dark-tech btn-card" style="font-size: 1.5rem; text-align: center;" asp-controller="Product" asp-action="Detail" asp-route-id="@p.ProductId">
                                    <i class="fa-regular fa-eye"></i> Chi tiết
                                </a>
                                    <button type="button" style="font-size: 1.5rem; text-align: center;" class="btn btn-primary-tech-2 btn-card add-to-cart-btn" data-product-id="@p.ProductId">
                                    <i class="fa-regular fa-cart-shopping"></i> Thêm
                                </button>
                            </div>
                        </div>
                    </article>
                </div>
            }
        </div>
    </div>
</section>

<!-- CTA STRIP -->
<div class="container my-4">
    <div class="cta-strip">
        <p><strong>Galaxy S24 Ultra</strong> — Quyền năng Galaxy AI. Kỷ nguyên AI trên di động.</p>
            <a class="btn btn-primary-tech" style="border-radius:12px; font-size: 2rem; text-align: center;min-height:44px" asp-controller="Product" asp-action="Index">
            <i class="fa-regular fa-arrow-right me-1"></i> Khám phá
        </a>
    </div>
</div>

    <script>
        document.addEventListener('click', async (e) => {
            // Tìm nút được bấm (xử lý cả khi bấm vào icon bên trong nút)
            const btn = e.target.closest('.add-to-cart-btn');
            if (!btn) return;

            // Hiệu ứng loading nhẹ
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
            btn.disabled = true;

            const id = btn.dataset.productId;

            try {
                // 1. Sửa đường dẫn thành /Cart/AddToCart (khớp với Controller)
                const res = await fetch(`/Cart/AddToCart?productId=${id}&quantity=1`, { method: 'POST' });

                if (res.ok) {
                    // 2. Đọc dữ liệu JSON trả về từ Controller
                    const data = await res.json();

                    if (data.success) {
                        // Thành công: Đổi icon thành dấu tích
                        btn.innerHTML = '<i class="fa-regular fa-check"></i> Đã thêm';

                        // Cập nhật số lượng trên Header (nếu có class .cart-count)
                        const cartCountEl = document.querySelector('.cart-count');
                        if(cartCountEl) cartCountEl.innerText = data.cartCount;

                        // Reset lại nút sau 1.5 giây
                        setTimeout(() => {
                            btn.innerHTML = originalContent;
                            btn.disabled = false;
                        }, 1500);
                    } else {
                        // Thất bại (do chưa đăng nhập hoặc lỗi khác)
                        alert(data.message); // Hiện thông báo từ server

                        if (data.message.includes("đăng nhập")) {
                            window.location.href = '/Account/Login';
                        }
                        btn.innerHTML = originalContent;
                        btn.disabled = false;
                    }
                } else {
                    alert('Lỗi kết nối server (Mã lỗi: ' + res.status + ')');
                    btn.innerHTML = originalContent;
                    btn.disabled = false;
                }
            } catch (err) {
                console.error(err);
                alert('Lỗi mạng. Vui lòng thử lại sau.');
                btn.innerHTML = originalContent;
                btn.disabled = false;
            }
        });
    </script>
